<!doctype html><html lang=zh-CN dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-v4 docs-doc-page docs-doc-id-Materials_management" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.2"><title data-rh=true>Materials management | lsfusion documentation</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:url content=https://lsfusion.github.io/v4/Materials_management/ /><meta data-rh=true property=og:locale content=zh_CN /><meta data-rh=true property=og:locale:alternate content=en /><meta data-rh=true property=og:locale:alternate content=ru /><meta data-rh=true name=docusaurus_locale content=zh-CN /><meta data-rh=true name=docsearch:language content=zh-CN /><meta data-rh=true name=docusaurus_version content=v4 /><meta data-rh=true name=docusaurus_tag content=docs-default-v4 /><meta data-rh=true name=docsearch:version content=v4 /><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-v4 /><meta data-rh=true property=og:title content="Materials management | lsfusion documentation"/><meta data-rh=true name=description content='Description of the "Materials management" task'/><meta data-rh=true property=og:description content='Description of the "Materials management" task'/><link data-rh=true rel=icon href=/img/favicon.ico /><link data-rh=true rel=canonical href=https://lsfusion.github.io/v4/Materials_management/ /><link data-rh=true rel=alternate href=https://lsfusion.github.io/v4/Materials_management/ hreflang=en /><link data-rh=true rel=alternate href=https://lsfusion.github.io/v4/Materials_management/ hreflang=ru /><link data-rh=true rel=alternate href=https://lsfusion.github.io/v4/Materials_management/ hreflang=zh-CN /><link data-rh=true rel=alternate href=https://lsfusion.github.io/v4/Materials_management/ hreflang=x-default /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://lsfusion.github.io/v4/Examples","name":"Examples","position":1},{"@type":"ListItem","item":"https://lsfusion.github.io/v4/Materials_management","name":"Materials management","position":2}]}</script><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="lsfusion documentation RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="lsfusion documentation Atom Feed"><link rel=preconnect href=https://www.google-analytics.com><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-38678623-1","auto"),ga("send","pageview")</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=G-9PP67L9JM9"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-9PP67L9JM9",{})</script><link rel=stylesheet href=/assets/css/styles.426fbe05.css /><script src=/assets/js/runtime~main.ac65b054.js defer></script><script src=/assets/js/main.e079f48b.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label=跳到主要内容><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>跳到主要内容</a></div><nav aria-label=主导航 class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label=切换导航栏 aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/logo.png alt=标志 class="themedComponent_mlkZ themedComponent--light_NVdE"/><img src=/img/logo.png alt=标志 class="themedComponent_mlkZ themedComponent--dark_xIcU"/></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href=/v4/Install/>安装</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/v4/>学习</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href=https://github.com/lsfusion/platform target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class=navbar__link aria-haspopup=true aria-expanded=false role=button href=/v4/Materials_management/>4.x</a><ul class=dropdown__menu><li><a class=dropdown__link href=/Materials_management/>6.x</a><li><a class=dropdown__link href=/v5/Materials_management/>5.x</a><li><a aria-current=page class="dropdown__link dropdown__link--active" href=/v4/Materials_management/>4.x</a></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link><svg viewBox="0 0 24 24" width=20 height=20 aria-hidden=true class=iconLanguage_nlXk><path fill=currentColor d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>中文</a><ul class=dropdown__menu><li><a href=/v4/Materials_management/ target=_self rel="noopener noreferrer" class=dropdown__link lang=en>English</a><li><a href=/v4/Materials_management/ target=_self rel="noopener noreferrer" class=dropdown__link lang=ru>Русский</a><li><a href=/v4/Materials_management/ target=_self rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang=zh-CN>中文</a></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_Bca1></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label=回到顶部 class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label=文档侧边栏 class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/v4/><span title=Overview class=linkLabel_WmDU>Overview</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/v4/Paradigm/><span title=范式 class=categoryLinkLabel_W154>范式</span></a><button aria-label="折叠侧边栏分类 '范式'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex=0 href=/v4/Logical_model/><span title=逻辑模型 class=categoryLinkLabel_W154>逻辑模型</span></a><button aria-label="展开侧边栏分类 '逻辑模型'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex=0 href=/v4/Physical_model/><span title="Physical model" class=categoryLinkLabel_W154>Physical model</span></a><button aria-label="展开侧边栏分类 'Physical model'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/v4/Language/><span title=Language class=categoryLinkLabel_W154>Language</span></a><button aria-label="折叠侧边栏分类 'Language'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/v4/Tokens/><span title=Tokens class=linkLabel_WmDU>Tokens</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/v4/IDs/><span title=IDs class=linkLabel_WmDU>IDs</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/v4/Literals/><span title=Literals class=linkLabel_WmDU>Literals</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex=0 href=/v4/Statements/><span title=Statements class=categoryLinkLabel_W154>Statements</span></a><button aria-label="展开侧边栏分类 'Statements'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/v4/Coding_conventions/><span title="Coding conventions" class=linkLabel_WmDU>Coding conventions</span></a></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/v4/IDE/><span title=IDE class=linkLabel_WmDU>IDE</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href=/v4/Examples/><span title=Examples class=categoryLinkLabel_W154>Examples</span></a><button aria-label="折叠侧边栏分类 'Examples'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/v4/Score_table/><span title="Score table" class=linkLabel_WmDU>Score table</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/v4/Materials_management/><span title="Materials management" class=linkLabel_WmDU>Materials management</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex=0 href=/v4/How-to/><span title=How-to class=categoryLinkLabel_W154>How-to</span></a><button aria-label="展开侧边栏分类 'How-to'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/v4/Online_demo/><span title="Online demo" class=linkLabel_WmDU>Online demo</span></a></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role=alert><div>此为 <!-- -->lsfusion documentation<!-- --> <b>4.x</b> 版的文档，现已不再积极维护。</div><div class=margin-top--md>最新的文档请参阅 <b><a href=/Materials_management/>最新版本</a></b> (<!-- -->6.x<!-- -->)。</div></div><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=页面路径><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label=主页面 class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/v4/Examples/><span>Examples</span></a><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>Materials management</span></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：4.x</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Materials management</h1></header><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=description-of-the-materials-management-task>Description of the "Materials management" task<a href=#description-of-the-materials-management-task class=hash-link aria-label='Description of the "Materials management" task的直接链接' title='Description of the "Materials management" task的直接链接' translate=no>​</a></h2>
<p>The information system being created using the <strong>lsFusion</strong> platform must support very basic supply chain execution capabilities.</p>
<p>For simplicity, let's define one type of document in our system that increases the stock balance — a receipt from the supplier; and one type of document that does the opposite — a shipment for a wholesale to a customer.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=defining-domain-logic>Defining domain logic<a href=#defining-domain-logic class=hash-link aria-label="Defining domain logic的直接链接" title="Defining domain logic的直接链接" translate=no>​</a></h2>
<p>The information system will consist of a set of <a class="" href=/v4/Modules/>modules</a>, each implementing a logically isolated piece of functionality. Each module can use the functionality of other modules, which involves special syntax constructions for defining module dependencies.</p>
<p>Based on our task, let's define the list of modules to be implemented: stock module, item module, legal entity module, receipt module, shipment module, current balance module. We will separately define the main module that will be executed and will basically be a compound solution. The composition of modules can be different and is determined by the developer depending on the need to re-use the functionality elsewhere.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=defining-a-stock>Defining a stock<a href=#defining-a-stock class=hash-link aria-label="Defining a stock的直接链接" title="Defining a stock的直接链接" translate=no>​</a></h3>
<p>Let's create a module where we will define a stock instance and its attributes.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">MODULE Stock;</span><br/></span></code></pre></div></div>
<p>Let's define the concept of a stock and its attributes: name, address.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">CLASS Stock 'Warehouse';</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">name 'Name' = DATA STRING[100] (Stock) IN base;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">address 'Address' = DATA STRING[150] (Stock) IN base;</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=defining-an-item>Defining an item<a href=#defining-an-item class=hash-link aria-label="Defining an item的直接链接" title="Defining an item的直接链接" translate=no>​</a></h3>
<p>Let's create a module in which we'll define the concept of an item and its attributes.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">MODULE Item;</span><br/></span></code></pre></div></div>
<p>Let's define the concept of an item and its attributes: name, barcode.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">CLASS Item 'Product';</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">name 'Name' = DATA STRING[100](Item) IN base;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">barcode 'Barcode' = DATA BPSTRING[13](Item) IN base;</span><br/></span></code></pre></div></div>
<p>Let's set the wholesale price for an item.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">salePrice 'Wholesale price' = DATA NUMERIC[17,2](Item) IN base;</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=defining-a-legal-entity>Defining a legal entity<a href=#defining-a-legal-entity class=hash-link aria-label="Defining a legal entity的直接链接" title="Defining a legal entity的直接链接" translate=no>​</a></h3>
<p>Let's create a module where we will define a legal entity instance and its attributes. In the system, legal entities will act as suppliers and customers.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">MODULE LegalEntity;</span><br/></span></code></pre></div></div>
<p>Let's define the concept of a legal entity and its attributes: name, legal address, Tax ID.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">CLASS LegalEntity 'Organization';</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">name 'Name' = DATA STRING[100](LegalEntity) IN base;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">address 'Address' = DATA STRING[150](LegalEntity) IN base;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">inn 'TIN' = DATA BPSTRING[9](LegalEntity) IN base;</span><br/></span></code></pre></div></div>
<p>We define the uniqueness of the Tax ID for the legal entity.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">legalEntityINN = GROUP AGGR LegalEntity legalEntity BY inn(legalEntity);</span><br/></span></code></pre></div></div>
<p>The <code>legalEntityINN</code> property binds an organization and a Tax ID one-to-one and allows to find a legal entity by a Tax ID. The expression of the property can be interpreted as follows: when grouping legal entities by Tax ID (<code>inn</code> property), each group must contain a non-repeating legal entity.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=defining-a-receipt>Defining a receipt<a href=#defining-a-receipt class=hash-link aria-label="Defining a receipt的直接链接" title="Defining a receipt的直接链接" translate=no>​</a></h3>
<p>Let's create a module where we'll define all instances and attributes required for defining the logic of a supplier receipt.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">MODULE Receipt;</span><br/></span></code></pre></div></div>
<p>Let's define the use of functionality from other modules in the <code>Receipt</code> module.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">REQUIRE Stock, Item, LegalEntity;</span><br/></span></code></pre></div></div>
<p>We define the concepts that determine the logic of a supplier receipt. Let's work on the premise that all documents (both receipts and shipments) in the system consist of a header and an item specification. Accordingly, let's define the concepts of a receipt header and receipt line.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">CLASS Receipt 'Receipt';</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">CLASS ReceiptDetail 'Receipt line';</span><br/></span></code></pre></div></div>
<p>Each receipt line contains a link to the document header, so in the end, the header and the subset of lines with links to this document together define the receipt from the user perspective. The <code>NONULL</code> parameter indicates that the link must be defined. The <code>DELETE</code> parameter specifies that if the main <code>Receipt</code> object is deleted, all <code>ReceiptDetail</code> lines linking to it will also be deleted. By default, when an object is deleted, all links to it are nullified. This way, without the <code>DELETE</code> parameter, the system will show an error message about an undefined link.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">receipt 'Line document' = DATA Receipt (ReceiptDetail) NONULL DELETE;</span><br/></span></code></pre></div></div>
<p>Let's define the line number in a receipt.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">index 'Line number' (ReceiptDetail d) =</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">        PARTITION SUM 1 IF d IS ReceiptDetail</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">        ORDER d BY receipt(d);</span><br/></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg></span>信息</div><div class=admonitionContent_BuS1><p>The use of the name of an object class in expressions is similar to using its identification number (id) created by the system for all objects by an automatic counter. In this case, the use of the <code>ORDER d</code> construct helps sort the lines of the receipt by the order of ascension of their id, i.e. basically in the order of their creation.</div></div>
<p>Here, the <code>PARTITION</code> operator uses the <code>BY</code> block that groups objects by a certain attribute. The calculation of the expression cumulative total is performed in each group. In this case, the line number is determined only within this line's document (<code>receipt</code> property).</p>
<p>We define a set of key attributes of a receipt header: number, date, supplier and its name, the stock where the product is received and its name. The name of the supplier and the stock will be needed in the future for displaying them on the form.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">number 'Receipt number' = DATA BPSTRING[10] (Receipt);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">date 'Receipt date' = DATA DATE (Receipt);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">supplier 'Supplier' = DATA LegalEntity (Receipt);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">nameSupplier 'Supplier name' (Receipt r) = name(supplier(r));</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">stock 'Warehouse' = DATA Stock (Receipt);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">nameStock 'Warehouse name' (Receipt r) = name(stock(r));</span><br/></span></code></pre></div></div>
<p>We define a set of key attributes of a receipt line: item and its name, quantity, supplier price, supplier amount (price multiplied by quantity).</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">item 'Product' = DATA Item (ReceiptDetail);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">nameItem 'Product name' (ReceiptDetail d) = name(item(d));</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">quantity 'Quantity' = DATA NUMERIC[16,4] (ReceiptDetail);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">price 'Supplier price' = DATA NUMERIC[17,2] (ReceiptDetail);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">sum 'Supplier amount' (ReceiptDetail d) = quantity(d) * price(d);</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=defining-a-shipment>Defining a shipment<a href=#defining-a-shipment class=hash-link aria-label="Defining a shipment的直接链接" title="Defining a shipment的直接链接" translate=no>​</a></h3>
<p>Let's create a module where we will define all instances and attributes required for a wholesale shipment.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">MODULE Shipment;</span><br/></span></code></pre></div></div>
<p>We define the use of functionality from other modules in the <code>Shipment</code> module.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">REQUIRE Stock, Item, LegalEntity;</span><br/></span></code></pre></div></div>
<p>Similarly to the receipt, we define the shipment header and lines, as well as a link in the line to the header and its number.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">CLASS Shipment 'Shipment';</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">CLASS ShipmentDetail 'Shipment line';</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">shipment 'Line document' = DATA Shipment (ShipmentDetail) NONULL DELETE;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">index 'Line number' (ShipmentDetail d) =</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">        PARTITION SUM 1 IF d IS ShipmentDetail</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">        ORDER d BY shipment(d);</span><br/></span></code></pre></div></div>
<p>We define a set of attributes for the shipment: number, date, customer and its name, the stock from which the item is shipped, and its name.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">number 'Shipment number' = DATA BPSTRING[10] (Shipment);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">date 'Shipment date' = DATA DATE (Shipment);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">customer 'Customer' = DATA LegalEntity (Shipment);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">nameCustomer 'Customer name' (Shipment s) = name(customer(s));</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">stock 'Warehouse' = DATA Stock(Shipment);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">nameStock 'Warehouse name' (Shipment s) = name(stock(s));</span><br/></span></code></pre></div></div>
<p>We define a set of key attributes of a shipment: item and its name, quantity, sale price, sale amount (price multiplied by quantity).</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">item 'Product' = DATA Item (ShipmentDetail);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">nameItem 'Product name' (ShipmentDetail d) = name(item(d));</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">quantity 'Quantity' = DATA NUMERIC[16,4](ShipmentDetail);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">price 'Selling price' = DATA NUMERIC[17,2](ShipmentDetail);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">sum 'Sale amount' (ShipmentDetail d) = quantity(d) * price(d);</span><br/></span></code></pre></div></div>
<p>We implement the auto filling of the item sale price in the shipment with the value of the wholesale price defined by the user for item (<code>salePrice</code> property). Auto filling for the shipment line should work when the item is changed (<code>WHEN CHANGED</code> statement).</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">price(ShipmentDetail d) &lt;- salePrice(item(d)) WHEN CHANGED(item(d));</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=defining-current-item-balance>Defining current item balance<a href=#defining-current-item-balance class=hash-link aria-label="Defining current item balance的直接链接" title="Defining current item balance的直接链接" translate=no>​</a></h3>
<p>The current item balance is defined as a difference between all item receipts and all its shipments.</p>
<p>Let's create a separate module.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">MODULE StockItem;</span><br/></span></code></pre></div></div>
<p>We define the use of functionality from other modules in the <code>StockItem</code> module.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">REQUIRE Shipment, Receipt;</span><br/></span></code></pre></div></div>
<p>Let's define the calculated property of the current item balance at the stock in quantitative terms.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">receivedQuantity 'Total income' = GROUP SUM quantity(ReceiptDetail d) BY item(d), stock(receipt(d));</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">shippedQuantity 'Total expenses' = GROUP SUM quantity(ShipmentDetail d) BY item(d), stock(shipment(d));</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">currentBalance 'Current balance' (Item i, Stock s) = receivedQuantity (i, s) (-) shippedQuantity (i, s);</span><br/></span></code></pre></div></div>
<p>Let's prohibit the negative item balance. The prohibition will work for any user action resulting in a negative balance. In this case, the user will see a specified message on the screen.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">CONSTRAINT currentBalance(Item i, Stock s) &lt; 0 MESSAGE 'The balance of the product cannot be negative';</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=defining-view-logic>Defining view logic<a href=#defining-view-logic class=hash-link aria-label="Defining view logic的直接链接" title="Defining view logic的直接链接" translate=no>​</a></h2>
<p>In order to be able to work with the created solution, let's add directory forms and a current balances form, and also a set of paired forms for working with documents: a form for listing receipts and a form for editing them, a form for listing shipments and a form for editing them.</p>
<p>First, let's create directory forms.</p>
<p>In the <code>Stock</code> module, we add a form that provides the user with the functionality of creating and deleting stocks, as well as changing their attributes.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">FORM stocks 'Warehouses'</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	OBJECTS s = Stock</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(s) name, address, NEW, DELETE</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">;</span><br/></span></code></pre></div></div>
<p>In a similar manner, we'll create an item form in the <code>Item</code> module, and a legal entity form in the <code>LegalEntity</code> module.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">CLASS Item 'Product';</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">name 'Name' = DATA STRING[100](Item) IN base;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">barcode 'Barcode' = DATA BPSTRING[13](Item) IN base;</span><br/></span></code></pre></div></div>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">CLASS LegalEntity 'Organization';</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">name 'Name' = DATA STRING[100](LegalEntity) IN base;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">address 'Address' = DATA STRING[150](LegalEntity) IN base;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">inn 'TIN' = DATA BPSTRING[9](LegalEntity) IN base;</span><br/></span></code></pre></div></div>
<p>Let's create edit forms for a receipt and a shipment. These forms will be used for creating new documents or editing existing ones. The layout of the forms will be similar: two vertical blocks, the top one containing a panel with the header attributes of the document being created/edited, and the lower one containing the document lines in a grid view and their attributes.</p>
<p>In the Receipt module, we should create a receipt edit form. For the form we are building, we specify that it will be used as a default form for creating/editing receipts (the <code>EDIT</code> form block).</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">FORM receipt 'Receipt'</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	OBJECTS r = Receipt PANEL</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(r) number, date, nameSupplier, nameStock</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	OBJECTS d = ReceiptDetail</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(d) index, nameItem, quantity, price, sum READONLY, NEW, DELETE GRID</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	FILTERS receipt(d) = r</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	EDIT Receipt OBJECT r</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">;</span><br/></span></code></pre></div></div>
<p>Line filtering for the current receipt is performed with the help of the <code>FILTERS receipt(d) == r</code> expression. The <code>FILTERS</code> construct displays an object of a corresponding class on the form if the filter expression returns a value different from <code>NULL</code>. In this case, the receipt line will be displayed on the form if the header of the document to which the line is linked (<code>receipt</code> property) equals to the current object of the top block. In other words, only the lines of the created/edited document will be displayed.</p>
<p>In addition, if a filter is specified for objects of this class on the form, then when the user presses the <code>NEW</code> button, the property of the newly added object will be automatically filled in a way that will make this object meet the filter conditions. In this case, when a new receipt line is created, the <code>receipt</code> property of this line will be automatically filled with a link to the current header of the receipt.</p>
<p>Let's create an edit form for the shipment in the <code>Shipment</code> module. For the form we are creating, we specify that it will be used as the default form for creating/editing shipments (<code>EDIT</code> form block).</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">FORM shipment 'Shipment'</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	OBJECTS s = Shipment PANEL</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(s) number, date, nameCustomer, nameStock</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	OBJECTS d = ShipmentDetail</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(d) nameItem, quantity, price, sum READONLY, NEW, DELETE GRID</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	FILTERS shipment(d) = s</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	EDIT Shipment OBJECT s</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">;</span><br/></span></code></pre></div></div>
<p>Visually, supplier receipt and shipment forms will look almost identical and consist of two vertical blocks: one with a table for document headers and one with a table of document lines. Document lines should support visual filtering by documents and their subsets displayed on the form will change when navigating in the top block.</p>
<p>Let's create a receipt form. On this form, we will display all the properties defined above for document headers and their lines. Additionally, we will place automatically defined buttons for creating/editing a receipt using the edit form created above. All properties of document headers and their lines, except the buttons for creating/editing a receipt, should be read-only for editing directly on the form (<code>READONLY</code> operator).</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">FORM receipts 'Receipts'</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	OBJECTS r = Receipt</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(r) READONLY number, date, nameSupplier, nameStock</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(r) NEWSESSION NEW, EDIT, DELETE</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	OBJECTS d = ReceiptDetail</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(d) READONLY index, nameItem, quantity, price, sum</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	FILTERS receipt(d) = r</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">;</span><br/></span></code></pre></div></div>
<p>Let's create the shipment form in a similar manner.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">FORM shipments 'Shipments'</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	OBJECTS s = Shipment</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(s) READONLY number, date, nameCustomer, nameStock</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(s) NEWSESSION NEW, EDIT, DELETE</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	OBJECTS d = ShipmentDetail</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(d) READONLY nameItem, quantity, price, sum</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	FILTERS shipment(d) = s</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">;</span><br/></span></code></pre></div></div>
<p>Next, in the <code>StockItem</code> module, let's create a form for displaying current balances. A form should be a table whose lines contain information about the item (its name and barcode), the name of the stock, and the current balance for this item at this stock. The count of lines on the form will be equal to the count of items entered into the system multiplied by the count of entered stocks. To display only relevant data (i.e. only those items and stocks, for whose intersection the current balance is not <code>NULL</code>), let's add a filter to the form.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">FORM currentBalanceItemStock 'Current balances'</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">    OBJECTS si = (s = Stock, i = Item)</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">    PROPERTIES READONLY name(i), barcode(i), name(s), currentBalance(i, s)</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">    FILTERS currentBalance(i, s)</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">;</span><br/></span></code></pre></div></div>
<p>The <code>OBJECTS si = (s = Stock, i = Item)</code> construct adds an object group with the name <code>si</code>, which is a Cartesian product of <code>Stock</code> and <code>Item</code> class objects.</p>
<p>Finally, let's declare the head module and specify what functionality from other modules will be used in it.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">MODULE StockAccounting;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">REQUIRE Stock, Item, LegalEntity, Receipt, Shipment, StockItem;</span><br/></span></code></pre></div></div>
<p>In the <code>StockAccounting</code> module, we compose the system menu. Directories should be added to the predefined <code>masterData</code> folder of the navigator that we show immediately after the directories. We place the current balance form to the main menu (horizontal window <code>root</code>). Links to directory and document forms will be shown on the vertical <code>toolbar</code> when the user selects a corresponding <code>root</code> folder.</p>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">NAVIGATOR {</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">    NEW FOLDER masterData 'Directories' FIRST WINDOW toolbar {</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">        NEW items;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">        NEW stocks;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">        NEW legalEntities;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">    }</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">    NEW FOLDER documents 'Documents' AFTER masterData WINDOW toolbar {</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">        NEW receipts;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">        NEW shipments;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">    }</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">    NEW currentBalanceItemStock AFTER documents;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">}</span><br/></span></code></pre></div></div>
<p>The process of creating an information system is completed.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=the-complete-source-code-on-github>The complete source code (on <a href=https://github.com/lsfusion/samples/tree/master/mm target=_blank rel="noopener noreferrer" class="">Github</a>)<a href=#the-complete-source-code-on-github class=hash-link aria-label=the-complete-source-code-on-github的直接链接 title=the-complete-source-code-on-github的直接链接 translate=no>​</a></h2>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">MODULE Stock;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">CLASS Stock 'Warehouse';</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">name 'Name' = DATA STRING[100] (Stock) IN base;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">address 'Address' = DATA STRING[150] (Stock) IN base;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">FORM stocks 'Warehouses'</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	OBJECTS s = Stock</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(s) name, address, NEW, DELETE</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">;</span><br/></span></code></pre></div></div>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">MODULE Item;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">CLASS Item 'Product';</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">name 'Name' = DATA STRING[100](Item) IN base;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">barcode 'Barcode' = DATA BPSTRING[13](Item) IN base;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">salePrice 'Wholesale price' = DATA NUMERIC[17,2](Item) IN base;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">FORM items 'Products'</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	OBJECTS i = Item</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(i) name, barcode, salePrice, NEW, DELETE</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">;</span><br/></span></code></pre></div></div>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">MODULE LegalEntity;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">CLASS LegalEntity 'Organization';</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">name 'Name' = DATA STRING[100](LegalEntity) IN base;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">address 'Address' = DATA STRING[150](LegalEntity) IN base;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">inn 'TIN' = DATA BPSTRING[9](LegalEntity) IN base;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">legalEntityINN = GROUP AGGR LegalEntity legalEntity BY inn(legalEntity);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">FORM legalEntities 'Organization'</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	OBJECTS l = LegalEntity</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(l) name, inn, address, NEW, DELETE</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">;</span><br/></span></code></pre></div></div>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">MODULE Receipt;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">REQUIRE Stock, Item, LegalEntity;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">CLASS Receipt 'Receipt';</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">CLASS ReceiptDetail 'Receipt line';</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">receipt 'Line document' = DATA Receipt (ReceiptDetail) NONULL DELETE;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">index 'Line number' (ReceiptDetail d) =</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">        PARTITION SUM 1 IF d IS ReceiptDetail</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">        ORDER d BY receipt(d);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">number 'Receipt number' = DATA BPSTRING[10] (Receipt);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">date 'Receipt date' = DATA DATE (Receipt);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">supplier 'Supplier' = DATA LegalEntity (Receipt);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">nameSupplier 'Supplier name' (Receipt r) = name(supplier(r));</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">stock 'Warehouse' = DATA Stock (Receipt);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">nameStock 'Warehouse name' (Receipt r) = name(stock(r));</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">item 'Product' = DATA Item (ReceiptDetail);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">nameItem 'Product name' (ReceiptDetail d) = name(item(d));</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">quantity 'Quantity' = DATA NUMERIC[16,4] (ReceiptDetail);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">price 'Supplier price' = DATA NUMERIC[17,2] (ReceiptDetail);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">sum 'Supplier amount' (ReceiptDetail d) = quantity(d) * price(d);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">FORM receipt 'Receipt'</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	OBJECTS r = Receipt PANEL</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(r) number, date, nameSupplier, nameStock</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	OBJECTS d = ReceiptDetail</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(d) index, nameItem, quantity, price, sum READONLY, NEW, DELETE GRID</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	FILTERS receipt(d) = r</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	EDIT Receipt OBJECT r</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">FORM receipts 'Receipts'</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	OBJECTS r = Receipt</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(r) READONLY number, date, nameSupplier, nameStock</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(r) NEWSESSION NEW, EDIT, DELETE</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	OBJECTS d = ReceiptDetail</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(d) READONLY index, nameItem, quantity, price, sum</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	FILTERS receipt(d) = r</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">;</span><br/></span></code></pre></div></div>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">MODULE Shipment;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">REQUIRE Stock, Item, LegalEntity;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">CLASS Shipment 'Shipment';</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">CLASS ShipmentDetail 'Shipment line';</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">shipment 'Line document' = DATA Shipment (ShipmentDetail) NONULL DELETE;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">index 'Line number' (ShipmentDetail d) =</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">        PARTITION SUM 1 IF d IS ShipmentDetail</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">        ORDER d BY shipment(d);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">number 'Shipment number' = DATA BPSTRING[10] (Shipment);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">date 'Shipment date' = DATA DATE (Shipment);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">customer 'Customer' = DATA LegalEntity (Shipment);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">nameCustomer 'Customer name' (Shipment s) = name(customer(s));</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">stock 'Warehouse' = DATA Stock(Shipment);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">nameStock 'Warehouse name' (Shipment s) = name(stock(s));</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">item 'Product' = DATA Item (ShipmentDetail);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">nameItem 'Product name' (ShipmentDetail d) = name(item(d));</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">quantity 'Quantity' = DATA NUMERIC[16,4](ShipmentDetail);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">price 'Selling price' = DATA NUMERIC[17,2](ShipmentDetail);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">sum 'Sale amount' (ShipmentDetail d) = quantity(d) * price(d);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">price(ShipmentDetail d) &lt;- salePrice(item(d)) WHEN CHANGED(item(d));</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">FORM shipment 'Shipment'</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	OBJECTS s = Shipment PANEL</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(s) number, date, nameCustomer, nameStock</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	OBJECTS d = ShipmentDetail</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(d) nameItem, quantity, price, sum READONLY, NEW, DELETE GRID</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	FILTERS shipment(d) = s</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	EDIT Shipment OBJECT s</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">FORM shipments 'Shipments'</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	OBJECTS s = Shipment</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(s) READONLY number, date, nameCustomer, nameStock</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(s) NEWSESSION NEW, EDIT, DELETE</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	OBJECTS d = ShipmentDetail</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	PROPERTIES(d) READONLY nameItem, quantity, price, sum</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">	FILTERS shipment(d) = s</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">;</span><br/></span></code></pre></div></div>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">MODULE StockItem;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">REQUIRE Shipment, Receipt;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">receivedQuantity 'Total income' = GROUP SUM quantity(ReceiptDetail d) BY item(d), stock(receipt(d));</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">shippedQuantity 'Total expenses' = GROUP SUM quantity(ShipmentDetail d) BY item(d), stock(shipment(d));</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">currentBalance 'Current balance' (Item i, Stock s) = receivedQuantity (i, s) (-) shippedQuantity (i, s);</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">CONSTRAINT currentBalance(Item i, Stock s) &lt; 0 MESSAGE 'The balance of the product cannot be negative';</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">FORM currentBalanceItemStock 'Current balances'</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">    OBJECTS si = (s = Stock, i = Item)</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">    PROPERTIES READONLY name(i), barcode(i), name(s), currentBalance(i, s)</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">    FILTERS currentBalance(i, s)</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">;</span><br/></span></code></pre></div></div>
<div class="language-lsf codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#403f53;--prism-background-color:#FBFBFB><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-lsf codeBlock_bY9V thin-scrollbar" style=color:#403f53;background-color:#FBFBFB><code class=codeBlockLines_e6Vv><span class=token-line style=color:#403f53><span class="token plain">MODULE StockAccounting;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">REQUIRE Stock, Item, LegalEntity, Receipt, Shipment, StockItem;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#403f53><span class="token plain">NAVIGATOR {</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">    NEW FOLDER masterData 'Directories' FIRST WINDOW toolbar {</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">        NEW items;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">        NEW stocks;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">        NEW legalEntities;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">    }</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">    NEW FOLDER documents 'Documents' AFTER masterData WINDOW toolbar {</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">        NEW receipts;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">        NEW shipments;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">    }</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">    NEW currentBalanceItemStock AFTER documents;</span><br/></span><span class=token-line style=color:#403f53><span class="token plain">}</span><br/></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href=https://github.com/lsfusion/platform/edit/v4/docs/zh-CN/Materials_management.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"><span class=theme-last-updated>最后<!-- -->于 <b><time datetime=2021-06-07T15:00:33.000Z itemprop=dateModified>2021年6月7日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label=文件选项卡><a class="pagination-nav__link pagination-nav__link--prev" href=/v4/Score_table/><div class=pagination-nav__sublabel>上一页</div><div class=pagination-nav__label>Score table</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/v4/How-to/><div class=pagination-nav__sublabel>下一页</div><div class=pagination-nav__label>How-to</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#description-of-the-materials-management-task class="table-of-contents__link toc-highlight">Description of the "Materials management" task</a><li><a href=#defining-domain-logic class="table-of-contents__link toc-highlight">Defining domain logic</a><ul><li><a href=#defining-a-stock class="table-of-contents__link toc-highlight">Defining a stock</a><li><a href=#defining-an-item class="table-of-contents__link toc-highlight">Defining an item</a><li><a href=#defining-a-legal-entity class="table-of-contents__link toc-highlight">Defining a legal entity</a><li><a href=#defining-a-receipt class="table-of-contents__link toc-highlight">Defining a receipt</a><li><a href=#defining-a-shipment class="table-of-contents__link toc-highlight">Defining a shipment</a><li><a href=#defining-current-item-balance class="table-of-contents__link toc-highlight">Defining current item balance</a></ul><li><a href=#defining-view-logic class="table-of-contents__link toc-highlight">Defining view logic</a><li><a href=#the-complete-source-code-on-github class="table-of-contents__link toc-highlight">The complete source code (on Github)</a></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>文档</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/>lsf 文档</a><li class=footer__item><a href=https://lsfusion.org/ru/ed_materials target=_blank rel="noopener noreferrer" class=footer__link-item>学习资料<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>社区</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://t.me/lsfusion_official target=_blank rel="noopener noreferrer" class=footer__link-item>Telegram<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://join.slack.com/t/lsfusion/shared_invite/zt-1itj7vlmf-9aBIP__nj9iMJglDaecqXg target=_blank rel="noopener noreferrer" class=footer__link-item>Slack<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://ru.stackoverflow.com/questions/tagged/lsfusion target=_blank rel="noopener noreferrer" class=footer__link-item>Stack Overflow<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>更多</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://habr.com/ru/company/lsfusion/blog/ target=_blank rel="noopener noreferrer" class=footer__link-item>Habr<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://github.com/lsfusion/platform target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>版权所有 © 2025 lsFusion 基金会。使用 Docusaurus 构建。</div></div></div></footer></div></body>