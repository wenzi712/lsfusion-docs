"use strict";(self.webpackChunkls_fusion_docs=self.webpackChunkls_fusion_docs||[]).push([["81178"],{36319:function(e,n,r){r.r(n),r.d(n,{metadata:()=>t,default:()=>u,frontMatter:()=>d,contentTitle:()=>l,toc:()=>s,assets:()=>i});var t=JSON.parse('{"id":"How-to_WHILE","title":"How-to: WHILE","description":"Example 1","source":"@site/versioned_docs/version-v5/How-to_WHILE.md","sourceDirName":".","slug":"/How-to_WHILE","permalink":"/v5/How-to_WHILE","draft":false,"unlisted":false,"editUrl":"https://github.com/lsfusion/platform/edit/v5/docs/zh-CN/How-to_WHILE.md","tags":[],"version":"v5","lastUpdatedAt":1685108136000,"frontMatter":{"title":"How-to: WHILE"},"sidebar":"learn","previous":{"title":"How-to: IF/CASE","permalink":"/v5/How-to_IF_CASE"},"next":{"title":"How-to: NEWSESSION","permalink":"/v5/How-to_NEWSESSION"}}'),o=r(74848),a=r(28453);let d={title:"How-to: WHILE"},l,i={},s=[{value:"Example 1",id:"example-1",level:2},{value:"Task",id:"task",level:3},{value:"Solution",id:"solution",level:3},{value:"Example 2",id:"example-2",level:2},{value:"Task",id:"task-1",level:3},{value:"Solution",id:"solution-1",level:3},{value:"Example 3",id:"example-3",level:2},{value:"Task",id:"task-2",level:3},{value:"Solution",id:"solution-2",level:3}];function c(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"example-1",children:"Example 1"}),"\n",(0,o.jsx)(n.h3,{id:"task",children:"Task"}),"\n",(0,o.jsx)(n.p,{children:"We have an order for which a date is defined."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-lsf",children:"CLASS Order 'Order';\r\n\r\ndate 'Date' = DATA DATE (Order);\n"})}),"\n",(0,o.jsx)(n.p,{children:"We need to display a message containing the number of orders for each date from a given interval."}),"\n",(0,o.jsx)(n.h3,{id:"solution",children:"Solution"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-lsf",children:"countOrders (DATE date) = GROUP SUM 1 BY date(Order o);\r\n\r\nmessageCountOrders 'Count the number of orders' (DATE dFrom, DATE dTo)  {\r\n    // Option 1\r\n    LOCAL date = DATE ();\r\n    date() <- dFrom;\r\n\r\n    WHILE date() <= dTo DO {\r\n        MESSAGE 'Number of orders for ' + date () + ' : ' + OVERRIDE countOrders(date()), 0.0;\r\n        date() <- sum(date(), 1);\r\n    }\r\n\r\n    // Option 2\r\n    FOR iterate(DATE date, dFrom, dTo) DO\r\n        MESSAGE 'Number of orders for ' + date + ' : ' + OVERRIDE countOrders(date()), 0.0;\r\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"Both these options will provide the same result."}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"sum"})," property defined in the ",(0,o.jsx)(n.code,{children:"Time"})," system ",(0,o.jsx)(n.a,{href:"/v5/Modules",children:"module"})," is used to add one day to the given date."]}),"\n",(0,o.jsx)(n.h2,{id:"example-2",children:"Example 2"}),"\n",(0,o.jsx)(n.h3,{id:"task-1",children:"Task"}),"\n",(0,o.jsxs)(n.p,{children:["Similar to ",(0,o.jsx)(n.a,{href:"#example-1",children:(0,o.jsx)(n.strong,{children:"Example 1"})}),". We have also defined order lines, so that each line contains the (full) amount and the discount."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-lsf",children:"CLASS OrderDetail 'Order line';\r\norder 'Order' = DATA Order (OrderDetail) NONULL DELETE;\r\n\r\nsum 'Amount' = DATA NUMERIC[14,2] (OrderDetail);\r\ndiscountSum 'Discount amount' = DATA NUMERIC[14,2] (OrderDetail);\n"})}),"\n",(0,o.jsx)(n.p,{children:'We need to create an action that "distributes" given discount by line, starting from the line with the largest amount.'}),"\n",(0,o.jsx)(n.h3,{id:"solution-1",children:"Solution"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-lsf",children:"distributeDiscount 'Distribute discount' (Order o, NUMERIC[14,2] discount)  {\r\n    LOCAL discount = NUMERIC[14,2] ();\r\n    discount() <- discount;\r\n\r\n    LOCAL leftSum = NUMERIC[14,2] (OrderDetail);\r\n    leftSum(OrderDetail d) <- sum(d) WHERE order(d) == o;\r\n\r\n    WHILE discount() > 0 DO {\r\n        // finding the row with the largest \"remaining\" amount\r\n        FOR OrderDetail d == [ GROUP LAST OrderDetail od ORDER leftSum(od), od BY order(od)](o) DO { \r\n            discountSum(d) <- MIN leftSum(d), discount();\r\n            discount() <- discount() (-) discountSum(d);\r\n        }\r\n        IF (GROUP SUM 1 IF leftSum(OrderDetail d) > 0) THEN\r\n            BREAK; // nothing left to break down\r\n    }\r\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"example-3",children:"Example 3"}),"\n",(0,o.jsx)(n.h3,{id:"task-2",children:"Task"}),"\n",(0,o.jsx)(n.p,{children:"The logic for changing the balance for the book is defined as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-lsf",children:"CLASS Book 'Book';\r\n\r\nCLASS Ledger 'Change balance';\r\ndate 'Date' = DATA DATE (Ledger);\r\nbook 'Book' = DATA Book (Ledger);\r\nquantity 'Qty' = DATA NUMERIC[14,2] (Ledger);\n"})}),"\n",(0,o.jsx)(n.p,{children:"We need to create an action that will calculate the accumulated (integral) balance for a given time period."}),"\n",(0,o.jsx)(n.h3,{id:"solution-2",children:"Solution"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-lsf",children:"calculateIntegral (DATE dFrom, DATE dTo)  {\r\n    LOCAL date = DATE();\r\n    date() <- dFrom;\r\n\r\n    LOCAL balance = NUMERIC[14,2] (Book);\r\n    balance(Book b) <- [ GROUP SUM quantity(Ledger l) IF date(l) < dFrom BY book(l)](b);\r\n\r\n    LOCAL cumBalance = NUMERIC[14,2] (Book);\r\n\r\n    WHILE date() <= dTo DO {\r\n        cumBalance(Book b) <- cumBalance(b) (+) balance(b); //\r\n        balance(Book b) <- balance(b) (+) [ GROUP SUM quantity(Ledger l) BY book(l), date(l)](b, date());\r\n        date() <- sum(date(), 1);\r\n    }\r\n\r\n    FOR cumBalance(Book b) DO {\r\n        MESSAGE 'Accumulated balance for book ' + b + ' : ' + cumBalance(b);\r\n    }\r\n}\n"})})]})}function u(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},28453:function(e,n,r){r.d(n,{R:()=>d,x:()=>l});var t=r(96540);let o={},a=t.createContext(o);function d(e){let n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:d(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);